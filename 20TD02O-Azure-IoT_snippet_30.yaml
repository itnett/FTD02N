# OPA policy for tilgangskontroll
package iot.access

default allow = false

allow {
  input.method == "GET"
  input.path == "/device/data"
  input.user.role == "admin"
}

allow {
  input.method == "POST"
  input.path == "/device/update"
  input.user.role == "admin"
}

allow {
  input.method == "GET"
  input.path == "/device/data"
  input.user.role == "user"
  input.user.id == input.device.owner_id
}